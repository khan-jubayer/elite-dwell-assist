'use strict';

var Region = require('region')
var assign = require('object-assign')
var selectParent = require('select-parent')

module.exports = function(props, pickerProps, constrainTo){
    var constrainRegion

    if (constrainTo === true){
        constrainRegion = Region.getDocRegion()
    }

    if (!constrainRegion && typeof constrainTo === 'string'){
        var parent = selectParent(constrainTo, this.getDOMNode())
        constrainRegion = Region.from(parent)
    }

    if (!constrainRegion && typeof constrainTo === 'function'){
        constrainRegion = Region.from(constrainTo())
    }

    var field = this.refs.field

    if (!field){
        return
    }

    var fieldRegion = Region.from(field.getDOMNode())

    if (typeof props.constrainPicker === 'function'){
        props.constrainPicker(pickerProps, fieldRegion, constrainRegion)
        return
    }

    if (!constrainRegion || !(constrainRegion instanceof Region)){
        return
    }

    var topAvailable    = fieldRegion.top - constrainRegion.top
    var bottomAvailable = constrainRegion.bottom - fieldRegion.bottom

    var max = bottomAvailable

    var style = pickerProps.style

    if (topAvailable > bottomAvailable){
		style.bottom = '100%'
        delete style.top
    }
}